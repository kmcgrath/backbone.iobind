/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(a){typeof exports=="object"?module.exports=a(require("backbone"),require("underscore")):typeof define=="function"&&define.amd&&define(["backbone","underscore"],a)})(function(a,b){a.sync=function(d,e,f){var g=b.extend({},f);g.url?g.url=b.result(g,"url"):g.url=b.result(e,"url")||c();var h=g.url.split("/"),i=h[0]!==""?h[0]:h[1];!g.data&&e&&(g.data=g.attrs||e.toJSON(f)||{}),g.patch===!0&&g.data.id==null&&e&&(g.data.id=e.id);var j=e.socket||a.socket||window.socket,k=$.Deferred();j.emit(i+":"+d,g.data,function(a,b){a?(f.error&&f.error(a),k.reject()):(f.success&&f.success(b),k.resolve())});var l=k.promise();return e.trigger("request",e,l,f),l};var c=function(){throw new Error('A "url" property or function must be specified')};return a})